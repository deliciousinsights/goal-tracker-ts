<!DOCTYPE html><html lang="en"><head><title>history/HistoryScreen</title></head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0"><meta name="groc-relative-root" content="../"><meta name="groc-document-path" content="history/HistoryScreen"><meta name="groc-project-path" content="src/history/HistoryScreen.tsx"><link rel="stylesheet" type="text/css" media="all" href="../assets/style.css"><script type="text/javascript" src="../assets/behavior.js"></script><body><div id="meta"><div class="file-path">src/history/HistoryScreen.tsx</div></div><div id="document"><div class="segment"><div class="comments "><div class="wrapper"><h1 id="historique">Historique</h1></div></div></div><div class="segment"><div class="code"><div class="wrapper"><span class="hljs-keyword">import</span> { Link } from <span class="hljs-string">'react-router-dom'</span>
<span class="hljs-keyword">import</span> { useEffect } from <span class="hljs-string">'react'</span>

<span class="hljs-keyword">import</span> ArrowBack from <span class="hljs-string">'@mui/icons-material/ArrowBack'</span>
<span class="hljs-keyword">import</span> Button from <span class="hljs-string">'@mui/material/Button'</span>
<span class="hljs-keyword">import</span> Card from <span class="hljs-string">'@mui/material/Card'</span>
<span class="hljs-keyword">import</span> CardActions from <span class="hljs-string">'@mui/material/CardActions'</span>
<span class="hljs-keyword">import</span> CardContent from <span class="hljs-string">'@mui/material/CardContent'</span>
<span class="hljs-keyword">import</span> CardHeader from <span class="hljs-string">'@mui/material/CardHeader'</span>
<span class="hljs-keyword">import</span> ClearIcon from <span class="hljs-string">'@mui/icons-material/Clear'</span>
<span class="hljs-keyword">import</span> Typography from <span class="hljs-string">'@mui/material/Typography'</span>

<span class="hljs-keyword">import</span> { clearHistory } from <span class="hljs-string">'../reducers/history'</span>
<span class="hljs-keyword">import</span> HistoryDay from <span class="hljs-string">'./HistoryDay'</span>
<span class="hljs-keyword">import</span> { useAppDispatch, useAppSelector } from <span class="hljs-string">'../store'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">HistoryScreen</span>(<span class="hljs-params"></span>) </span>{</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Au premier rendu, on ajuste le titre du document pour permettre un
historique de navigation utilisable (et pas une tonne de titres
identiques).  Le <a href="https://fr.reactjs.org/docs/hooks-reference.html#conditionally-firing-an-effect">deuxième
argument</a>
est le tableau de dépendances qui indique quand relancer l’effet : comme il
est vide, seul le premier rendu du composant est concerné.</p></div></div><div class="code"><div class="wrapper">  useEffect(() =&gt; {
    <span class="hljs-built_in">document</span>.title = <span class="hljs-string">'Mon historique'</span>
  }, [])</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>On s’intéresse uniquement aux champs <code>goals</code> et <code>history</code> de l’état global,
qu’on veut retrouver dans nos propriétés sous les mêmes noms.  Par
ricochet, seuls les changements apportés à ces champs entraîneront un
éventuel <em>re-render</em> de notre conteneur.</p></div></div><div class="code"><div class="wrapper">  <span class="hljs-keyword">const</span> { goals, history } = useAppSelector(({ goals, history }) =&gt; ({
    goals,
    history,
  }))</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Vu qu’on va solliciter le <em>store</em> pour déclencher l’effacement de
l’historique, on a besoin de <code>dispatch</code> afin de lui envoyer une action.</p></div></div><div class="code"><div class="wrapper">  <span class="hljs-keyword">const</span> dispatch = useAppDispatch()

  <span class="hljs-keyword">return</span> (</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Quand on fait un bouton destiné à être en fait un lien, surtout au sein
d’un <a href="https://reacttraining.com/react-router/web/api/Link"><code>&lt;Link&gt;</code></a>, on
utilise la propriété
<a href="https://material-ui.com/api/button/#props"><code>component</code></a> pour altérer le
composant représentant la couche extérieure du bouton (en lieu et place
de <code>button</code>).  Les <em>props</em> non utilisées par <code>Button</code> sont alors passées
telles quelles à ce composant (ici la <em>prop</em> <code>to</code>).</p></div></div><div class="code"><div class="wrapper">    &lt;&gt;
      &lt;Button component={Link} startIcon={&lt;ArrowBack /&gt;} to=<span class="hljs-string">'/'</span> variant=<span class="hljs-string">'text'</span>&gt;
        Retour
      &lt;<span class="hljs-regexp">/Button&gt;
      &lt;Card className='history'&gt;
        &lt;CardHeader title='Historique' /</span>&gt;
        &lt;CardContent&gt;
          {history.map((dayStats) =&gt; (</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Pensez bien à toujours définir une association unique et <em>stable</em>
entre l’objet de base et son composant au sein d’un <code>map</code>, <a href="https://fr.reactjs.org/docs/lists-and-keys.html#keys">grâce
à la propriété
<code>key</code></a>.
Sinon, React va s’emmêler les pinceaux quand le tableau
sous-jacent change (suppression, réordonnancement…).</p></div></div><div class="code"><div class="wrapper">            &lt;HistoryDay goals={goals} key={dayStats.date} stats={dayStats} /&gt;
          ))}
          {</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Ici en revanche, on a l’exemple classique du “if”
<a href="https://fr.reactjs.org/docs/conditional-rendering.html#inline-if-with-logical--operator">façon
JSX</a>
: une condition suivie d’un et (<code>&amp;&amp;</code>) et du composant.  Si on avait
un <code>else</code> en plus, on préfèrerait un ternaire avec éventuellement
des parenthèses autour de chaque partie si au moins l’une d’elles
est multi-lignes.  Voir à ce sujet <a href="https://fr.reactjs.org/docs/conditional-rendering.html#inline-if-else-with-conditional-operator">Affichage
conditionnel</a>.</p></div></div><div class="code"><div class="wrapper">            history.length === <span class="hljs-number">0</span> &amp;&amp; (
              &lt;Typography&gt;Aucun historique disponible&lt;<span class="hljs-regexp">/Typography&gt;
            )
          }
        &lt;/</span>CardContent&gt;
        {history.length &gt; <span class="hljs-number">0</span> &amp;&amp; (
          &lt;CardActions&gt;
            &lt;Button
              onClick={() =&gt; dispatch(clearHistory())}
              startIcon={&lt;ClearIcon /&gt;}
              variant=<span class="hljs-string">'contained'</span>
            &gt;
              Effacer
            &lt;<span class="hljs-regexp">/Button&gt;
          &lt;/</span>CardActions&gt;
        )}
      &lt;<span class="hljs-regexp">/Card&gt;
    &lt;/</span>&gt;
  )
}</div></div></div></div></body></html>